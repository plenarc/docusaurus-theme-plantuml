# 設計文書

## 概要

この設計は、Docusaurus v3.9.2への対応を目的とし、それに伴って発生する各種コマンド実行時のエラーや警告を包括的に解決します。現在確認されている `pnpm run format` での npm 環境設定警告を含め、build、lint、test などの全コマンドでクリーンな実行環境を提供します。

## アーキテクチャ

### 問題の根本原因
- npmの環境設定ファイル（.npmrc）に、npmの将来バージョンでサポートされなくなる設定が含まれている
- pnpmがnpxを通じてbiomeを実行する際に、これらの設定が読み込まれて警告が発生

### 解決アプローチ
1. **Docusaurus v3.9.2 互換性確認**: 依存関係とプラグインの互換性を検証
2. **全コマンドの動作確認**: format、lint、build、test コマンドの実行状況を調査
3. **環境設定の最適化**: npm/pnpm 設定の問題を特定し修正
4. **依存関係の更新**: 必要に応じて依存パッケージのバージョン調整
5. **設定ファイルの更新**: TypeScript、Biome、その他の設定ファイルの調整

## コンポーネントとインターフェース

### 設定ファイル管理
- **.npmrc**: プロジェクトレベルまたはユーザーレベルの npm 設定
- **package.json**: フォーマットスクリプトの定義
- **biome.jsonc**: Biome フォーマッターの設定

### 実行フロー
```
各種 pnpm コマンド → 依存関係チェック → 設定ファイル読み込み → 警告/エラー発生
```

### 対象コマンド
- `pnpm run format`: Biome フォーマッター実行
- `pnpm run lint`: Biome リンター実行  
- `pnpm run build`: TypeScript ビルド
- `pnpm run test`: Node.js テスト実行
- その他の開発コマンド

## データモデル

### 環境設定構造
```typescript
interface NpmConfig {
  "verify-deps-before-run"?: boolean;  // 非推奨設定
  "_jsr-registry"?: string;            // 非推奨設定
  // その他の有効な設定...
}
```

### 設定ファイルの場所
- グローバル: `~/.npmrc`
- プロジェクト: `./npmrc`
- 環境変数: `NPM_CONFIG_*`

## エラーハンドリング

### 警告の種類と対処
1. **Unknown env config警告**
   - 原因: 非推奨または無効な設定項目
   - 対処: 設定の削除または更新

2. **設定ファイルが見つからない場合**
   - 新規作成は不要（警告が出ていないため）
   - 既存設定の修正のみ実施

3. **権限エラー**
   - ユーザーレベル設定ファイルへのアクセス権限確認
   - 適切な権限での実行指示

## テスト戦略

### 検証項目
1. **フォーマット実行の成功確認**
   - `pnpm run format` が警告なしで完了すること
   - フォーマット機能が正常に動作すること

2. **設定変更の影響確認**
   - 他のnpmコマンドに悪影響がないこと
   - pnpmの動作に問題がないこと

3. **クロスプラットフォーム対応**
   - Linux/macOS/Windows での動作確認
   - 異なる npm/pnpm バージョンでの互換性

### テスト手順
1. 現在の警告状況の記録
2. 設定変更の実施
3. フォーマットコマンドの再実行
4. 警告の消失確認
5. 他の機能への影響確認

## 実装の詳細

### Phase 1: 包括的調査
- 全コマンドの実行状況確認
- Docusaurus v3.9.2 互換性チェック
- 依存関係の問題特定
- 設定ファイルの検証

### Phase 2: 段階的修正
- npm/pnpm 環境設定の最適化
- 依存関係の更新
- 設定ファイルの調整
- TypeScript 設定の更新

### Phase 3: 総合検証
- 全コマンドの動作確認
- 警告・エラーの消失確認
- Docusaurus v3.9.2 での正常動作確認
- 開発ワークフローの検証